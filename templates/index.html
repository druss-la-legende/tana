<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tana - File Organizer</title>
    <link rel="icon" type="image/svg+xml" href="{{ url_for('static', filename='favicon.svg') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
    <script>
        // Apply theme before render to avoid flash
        const saved = localStorage.getItem("theme");
        if (saved === "light") document.documentElement.setAttribute("data-theme", "light");
    </script>
</head>
<body>
    <header>
        <h1>Tana</h1>
        <p class="subtitle" data-i18n="subtitle">Organise tes CBR / CBZ / PDF</p>
        <nav class="header-nav">
            <button class="nav-tab active" data-view="dashboard" type="button">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M3 9l9-7 9 7v11a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2z"/><polyline points="9 22 9 12 15 12 15 22"/></svg>
                <span data-i18n="tab.dashboard">Accueil</span>
            </button>
            <button class="nav-tab" data-view="files" type="button">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"/><polyline points="13 2 13 9 20 9"/></svg>
                <span data-i18n="tab.files">Fichiers</span>
            </button>
            <button class="nav-tab" data-view="audit" type="button">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M9 11l3 3L22 4"/><path d="M21 12v7a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V5a2 2 0 0 1 2-2h11"/></svg>
                <span data-i18n="tab.audit">Audit</span>
            </button>
            <button class="nav-tab" data-view="convert" type="button">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
                <span data-i18n="tab.convert">Convertir</span>
            </button>
            <button class="nav-tab" data-view="history" type="button">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/></svg>
                <span data-i18n="tab.history">Historique</span>
            </button>
            <button class="nav-tab" data-view="config" type="button">
                <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1 0 2.83 2 2 0 0 1-2.83 0l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-2 2 2 2 0 0 1-2-2v-.09A1.65 1.65 0 0 0 9 19.4a1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83 0 2 2 0 0 1 0-2.83l.06-.06A1.65 1.65 0 0 0 4.68 15a1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1-2-2 2 2 0 0 1 2-2h.09A1.65 1.65 0 0 0 4.6 9a1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 0-2.83 2 2 0 0 1 2.83 0l.06.06A1.65 1.65 0 0 0 9 4.68a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 2-2 2 2 0 0 1 2 2v.09a1.65 1.65 0 0 0 1 1.51 1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 0 2 2 0 0 1 0 2.83l-.06.06A1.65 1.65 0 0 0 19.4 9a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 2 2 2 2 0 0 1-2 2h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
                <span data-i18n="tab.config">Configuration</span>
            </button>
        </nav>
        <button id="btn-theme" class="theme-toggle" type="button" aria-label="Toggle theme">
            <svg class="icon-sun" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="5"/><line x1="12" y1="1" x2="12" y2="3"/><line x1="12" y1="21" x2="12" y2="23"/><line x1="4.22" y1="4.22" x2="5.64" y2="5.64"/><line x1="18.36" y1="18.36" x2="19.78" y2="19.78"/><line x1="1" y1="12" x2="3" y2="12"/><line x1="21" y1="12" x2="23" y2="12"/><line x1="4.22" y1="19.78" x2="5.64" y2="18.36"/><line x1="18.36" y1="5.64" x2="19.78" y2="4.22"/></svg>
            <svg class="icon-moon" width="18" height="18" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 12.79A9 9 0 1 1 11.21 3 7 7 0 0 0 21 12.79z"/></svg>
        </button>
    </header>

    <main>
        <!-- DASHBOARD VIEW -->
        <section id="view-dashboard">
            <div class="dashboard-header">
                <h2 data-i18n="dashboard.title">Vue d'ensemble</h2>
            </div>
            <div class="dashboard-stats" id="dashboard-stats">
                <div class="dashboard-card">
                    <span class="dashboard-card-value" id="dash-series">-</span>
                    <span class="dashboard-card-label" data-i18n="dashboard.series">S&#233;ries</span>
                </div>
                <div class="dashboard-card">
                    <span class="dashboard-card-value" id="dash-volumes">-</span>
                    <span class="dashboard-card-label" data-i18n="dashboard.volumes">Volumes</span>
                </div>
                <div class="dashboard-card">
                    <span class="dashboard-card-value" id="dash-size">-</span>
                    <span class="dashboard-card-label" data-i18n="dashboard.size">Taille totale</span>
                </div>
                <div class="dashboard-card">
                    <span class="dashboard-card-value" id="dash-activity">-</span>
                    <span class="dashboard-card-label" data-i18n="dashboard.activity">Activit&#233; (7j)</span>
                </div>
            </div>
            <div class="dashboard-sections">
                <div class="dashboard-section" id="dash-dest-section">
                    <h3 data-i18n="dashboard.by_dest">Par destination</h3>
                    <div id="dash-dest-bars"></div>
                </div>
                <div class="dashboard-section" id="dash-format-section">
                    <h3 data-i18n="dashboard.by_format">Par format</h3>
                    <div id="dash-format-bars"></div>
                </div>
            </div>
        </section>

        <!-- FILES VIEW -->
        <section id="view-files" style="display:none">
            <section class="file-list-section">
                <div class="file-list-header">
                    <div class="select-all-wrap">
                        <input type="checkbox" id="select-all">
                        <label for="select-all" data-i18n="files.select_all">Tout s&#233;lectionner</label>
                    </div>
                    <div class="filter-wrap">
                        <select id="filter-match" class="filter-select">
                            <option value="all" data-i18n="files.filter.all">Tous</option>
                            <option value="matched" data-i18n="files.filter.matched">Match&#233;s</option>
                            <option value="suggested" data-i18n="files.filter.suggested">Suggestions</option>
                            <option value="unmatched" data-i18n="files.filter.unmatched">Sans match</option>
                            <option value="duplicates" data-i18n="files.filter.duplicates">Doublons</option>
                        </select>
                    </div>
                    <button id="btn-organize-matched" type="button" class="btn-batch" style="display:none" data-i18n="files.btn.organize_matched">Organiser tous les match&#233;s</button>
                    <button id="btn-triage" type="button" class="btn-batch btn-triage-open" style="display:none" data-i18n="triage.btn_open">Triage rapide</button>
                    <span class="file-count" id="file-count"></span>
                    <button id="btn-import-files" type="button" class="btn-import" data-i18n-title="upload.btn_import" title="Importer des fichiers">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                        <span data-i18n="upload.btn_import">Importer</span>
                    </button>
                    <button id="btn-refresh-files" type="button" class="btn-config-add" data-i18n-title="files.btn.refresh" title="Rafra&#238;chir">
                        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polyline points="23 4 23 10 17 10"/><polyline points="1 20 1 14 7 14"/><path d="M3.51 9a9 9 0 0 1 14.85-3.36L23 10M1 14l4.64 4.36A9 9 0 0 0 20.49 15"/></svg>
                    </button>
                    <input type="file" id="file-input-hidden" multiple style="display:none">
                </div>
                <div class="file-table-wrap">
                    <table id="file-table">
                        <thead>
                            <tr>
                                <th class="col-check"></th>
                                <th class="col-name sortable" data-sort="name" data-i18n="files.col.file">Fichier</th>
                                <th class="col-series sortable" data-sort="series" data-i18n="files.col.series">S&#233;rie d&#233;tect&#233;e</th>
                                <th class="col-search-ext"></th>
                                <th class="col-match" data-i18n="files.col.existing">S&#233;rie existante</th>
                                <th class="col-tome sortable" data-sort="tome" data-i18n="files.col.tome">Tome</th>
                                <th class="col-title" data-i18n="files.col.title">Titre</th>
                                <th class="col-size sortable" data-sort="size" data-i18n="files.col.size">Taille</th>
                                <th class="col-actions"></th>
                            </tr>
                        </thead>
                        <tbody id="file-tbody">
                            <tr class="empty-row">
                                <td colspan="9" data-i18n="files.loading">Chargement...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </section>

            <section class="action-panel">
                <h2 data-i18n="action.organize">Organiser</h2>
                <div class="action-fields">
                    <div class="field">
                        <label for="series-name" data-i18n="action.series_name">Nom de la s&#233;rie</label>
                        <div class="action-search-wrap">
                            <input type="text" id="series-name" data-i18n-placeholder="action.series_placeholder" placeholder="Ex: One Piece" autocomplete="off">
                            <div class="action-dropdown" id="action-dropdown"></div>
                        </div>
                    </div>
                    <div class="field">
                        <label for="destination" data-i18n="action.destination">Destination</label>
                        <select id="destination">
                            <option value="" data-i18n="action.choose">-- Choisir --</option>
                        </select>
                    </div>
                </div>

                <div class="preview-section" id="preview-section" style="display:none;">
                    <h3 data-i18n="action.preview">Aper&#231;u</h3>
                    <ul id="preview-list"></ul>
                </div>

                <div class="action-buttons">
                    <button id="btn-organize" type="button" disabled data-i18n="action.btn_organize">Organiser les fichiers</button>
                </div>
            </section>
        </section>

        <!-- CONFIG VIEW -->
        <section id="view-config" style="display:none">
            <div class="config-panel">
                <h2 data-i18n="config.title">Configuration</h2>

                <div class="config-grid">
                    <div class="config-col">
                        <div class="config-section">
                            <label class="config-label" data-i18n="config.lang">Langue / Language</label>
                            <div class="config-input-row">
                                <select id="config-lang" class="config-input">
                                    <option value="fr">Fran&#231;ais</option>
                                    <option value="en">English</option>
                                </select>
                            </div>
                        </div>

                        <div class="config-section">
                            <label class="config-label" data-i18n="config.source_dir">Dossier source</label>
                            <p class="config-hint" data-i18n="config.source_hint">Dossier scann&#233; au d&#233;marrage pour trouver les fichiers &#224; organiser.</p>
                            <div class="config-input-row">
                                <input type="text" id="config-source" data-i18n-placeholder="config.source_placeholder" placeholder="/chemin/vers/dossier" class="config-input">
                            </div>
                        </div>

                        <div class="config-section">
                            <label class="config-label" data-i18n="config.dashboard_enabled">Page d'accueil</label>
                            <div class="config-checkbox-row">
                                <label class="config-checkbox-label">
                                    <input type="checkbox" id="config-dashboard-enabled">
                                    <span data-i18n="config.dashboard_enabled_hint">Afficher le dashboard avec les statistiques de la collection</span>
                                </label>
                            </div>
                        </div>
                    </div>

                    <div class="config-col">
                        <div class="config-section">
                            <label class="config-label" data-i18n="config.extensions">Formats de fichiers</label>
                            <p class="config-hint" data-i18n="config.extensions_hint">Extensions de fichiers pris en compte pour le scan et l'audit.</p>
                            <ul id="config-ext-list" class="config-dest-list"></ul>
                            <div class="config-input-row">
                                <input type="text" id="config-new-ext" placeholder=".epub" class="config-input" style="max-width:200px">
                                <button id="btn-add-ext" type="button" class="btn-config-add" data-i18n="config.btn_add">Ajouter</button>
                            </div>
                        </div>

                        <div class="config-section">
                            <label class="config-label" data-i18n="config.audit_case">Casse du nommage (audit)</label>
                            <p class="config-hint" data-i18n="config.audit_case_hint">V&#233;rification de la casse lors de l'audit de nommage.</p>
                            <div class="config-input-row">
                                <select id="config-audit-case" class="config-input">
                                    <option value="ignore" data-i18n="config.audit_case.ignore">Insensible &#224; la casse</option>
                                    <option value="first" data-i18n="config.audit_case.first">Premi&#232;re lettre majuscule</option>
                                    <option value="title" data-i18n="config.audit_case.title">Chaque Mot En Majuscule</option>
                                </select>
                            </div>
                        </div>
                    </div>

                    <div class="config-full">
                        <div class="config-section">
                            <label class="config-label" data-i18n="config.destinations">Dossiers de destination</label>
                            <p class="config-hint" data-i18n="config.destinations_hint">Dossiers dans lesquels les s&#233;ries sont organis&#233;es. Ils sont scann&#233;s pour d&#233;tecter les s&#233;ries existantes.</p>
                            <ul id="config-dest-list" class="config-dest-list"></ul>
                            <div class="config-input-row">
                                <input type="text" id="config-new-dest" data-i18n-placeholder="config.dest_placeholder" placeholder="/chemin/vers/nouveau/dossier" class="config-input">
                                <button id="btn-add-dest" type="button" class="btn-config-add" data-i18n="config.btn_add">Ajouter</button>
                            </div>
                        </div>

                        <div class="config-section">
                            <label class="config-label" data-i18n="config.template">Template de nommage (par d&#233;faut)</label>
                            <p class="config-hint" data-i18n="config.template_hint">Variables : {series}, {tome}, {tome:02d}, {tome:03d}, {title}, {ext}, {EXT}</p>
                            <div class="config-input-row">
                                <input type="text" id="config-template" placeholder="{series} - T{tome:02d}{ext}" class="config-input">
                            </div>
                            <p class="config-hint" style="margin-top:0.5rem"><span data-i18n="config.preview_label">Aper&#231;u :</span> <span id="template-preview" class="template-preview-text"></span></p>
                        </div>

                        <div class="config-section">
                            <label class="config-label" data-i18n="config.template_no_tome">Template sans tome (par d&#233;faut)</label>
                            <p class="config-hint" data-i18n="config.template_no_tome_hint">Utilis&#233; quand aucun num&#233;ro de tome n'est d&#233;tect&#233;.</p>
                            <div class="config-input-row">
                                <input type="text" id="config-template-no-tome" placeholder="{series}{ext}" class="config-input">
                            </div>
                        </div>

                        <div class="config-section">
                            <label class="config-label" data-i18n="config.rules">R&#232;gles de template par destination</label>
                            <p class="config-hint" data-i18n="config.rules_hint">Appliquer un template diff&#233;rent selon le chemin de destination. Le filtre est cherch&#233; dans le chemin.</p>
                            <ul id="config-rules-list" class="config-dest-list"></ul>
                            <div class="config-rule-add">
                                <div class="config-input-row">
                                    <input type="text" id="config-new-rule-filter" data-i18n-placeholder="config.rule_filter_placeholder" placeholder="Filtre (ex: manga)" class="config-input config-input-sm">
                                    <input type="text" id="config-new-rule-template" data-i18n-placeholder="config.rule_template_placeholder" placeholder="Template (ex: {series} T{tome:02d}{ext})" class="config-input">
                                </div>
                                <div class="config-input-row" style="margin-top:0.35rem">
                                    <input type="text" id="config-new-rule-no-tome" data-i18n-placeholder="config.rule_no_tome_placeholder" placeholder="Template sans tome (optionnel)" class="config-input">
                                    <button id="btn-add-rule" type="button" class="btn-config-add" data-i18n="config.btn_add">Ajouter</button>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="config-actions">
                    <button id="btn-save-config" type="button" data-i18n="config.btn_save">Sauvegarder</button>
                </div>
            </div>
        </section>

        <!-- HISTORY VIEW -->
        <section id="view-history" style="display:none">
            <div class="history-panel">
                <div class="history-header">
                    <h2 data-i18n="history.title">Historique des actions</h2>
                    <div class="history-controls">
                        <select id="history-filter-action" class="filter-select">
                            <option value="" data-i18n="history.filter.all">Toutes les actions</option>
                            <option value="organize" data-i18n="history.filter.organize">Organiser</option>
                            <option value="organize_batch" data-i18n="history.filter.organize_batch">Organiser (batch)</option>
                            <option value="delete" data-i18n="history.filter.delete">Supprimer</option>
                            <option value="undelete" data-i18n="history.filter.undelete">Restaurer</option>
                            <option value="fix_naming" data-i18n="history.filter.fix_naming">Correction nommage</option>
                            <option value="convert" data-i18n="history.filter.convert">Convertir CBR</option>
                            <option value="upload" data-i18n="history.filter.upload">Importer</option>
                        </select>
                        <button id="btn-refresh-history" type="button" class="btn-config-add" data-i18n="history.btn.refresh">Rafra&#238;chir</button>
                    </div>
                </div>

                <div class="history-table-wrap">
                    <table class="history-table">
                        <thead>
                            <tr>
                                <th class="col-history-time" data-i18n="history.col.date">Date</th>
                                <th class="col-history-action" data-i18n="history.col.action">Action</th>
                                <th class="col-history-detail" data-i18n="history.col.detail">D&#233;tail</th>
                                <th class="col-history-series" data-i18n="history.col.series">S&#233;rie</th>
                                <th class="col-history-undo"></th>
                            </tr>
                        </thead>
                        <tbody id="history-tbody">
                            <tr class="empty-row"><td colspan="5" data-i18n="history.empty">Aucune action enregistr&#233;e</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- AUDIT VIEW -->
        <section id="view-audit" style="display:none">
            <div class="audit-panel">
                <div class="audit-header">
                    <h2 data-i18n="audit.title">Audit de la collection</h2>
                    <button id="btn-run-audit" type="button" class="btn-config-add" data-i18n="audit.btn.run">Lancer l'audit</button>
                </div>

                <div class="audit-loader" id="audit-loader" style="display:none">
                    <div class="audit-loader-bar"></div>
                    <p class="audit-loader-text" data-i18n="audit.loading">Analyse de la collection en cours...</p>
                </div>

                <div class="audit-summary" id="audit-summary"></div>

                <div class="audit-controls" id="audit-controls" style="display:none">
                    <input type="text" id="audit-search" data-i18n-placeholder="audit.search_placeholder" placeholder="Rechercher une s&#233;rie..." class="audit-search-input">
                    <select id="audit-filter" class="filter-select">
                        <option value="all" data-i18n="audit.filter.all">Toutes les s&#233;ries</option>
                        <option value="issues" data-i18n="audit.filter.issues">Avec probl&#232;mes</option>
                        <option value="gaps" data-i18n="audit.filter.gaps">Tomes manquants</option>
                        <option value="naming" data-i18n="audit.filter.naming">Nommage incorrect</option>
                        <option value="duplicates" data-i18n="audit.filter.duplicates">Tomes dupliqu&#233;s</option>
                        <option value="empty" data-i18n="audit.filter.empty">Dossiers vides</option>
                        <option value="single" data-i18n="audit.filter.single">Fichier unique</option>
                    </select>
                </div>

                <div class="audit-table-wrap">
                    <table class="audit-table">
                        <thead>
                            <tr>
                                <th class="col-audit-expand"></th>
                                <th class="col-audit-series" data-i18n="audit.col.series">S&#233;rie</th>
                                <th class="col-audit-dest" data-i18n="audit.col.destination">Destination</th>
                                <th class="col-audit-count" data-i18n="audit.col.files">Fichiers</th>
                                <th class="col-audit-missing" data-i18n="audit.col.missing">Manquants</th>
                                <th class="col-audit-issues" data-i18n="audit.col.issues">Probl&#232;mes</th>
                            </tr>
                        </thead>
                        <tbody id="audit-tbody">
                            <tr class="empty-row"><td colspan="6" data-i18n="audit.empty_initial">Lancez un audit pour analyser votre collection</td></tr>
                        </tbody>
                    </table>
                </div>
            </div>
        </section>

        <!-- CONVERT VIEW -->
        <section id="view-convert" style="display:none">
            <div class="convert-panel">
                <div class="convert-header">
                    <h2 data-i18n="convert.title">Convertir CBR &rarr; CBZ</h2>
                </div>

                <div class="convert-controls">
                    <div class="convert-path-wrap">
                        <label class="config-label" data-i18n="convert.dir_label">S&#233;rie ou dossier &#224; scanner</label>
                        <div class="convert-path-input-wrap">
                            <input type="text" id="convert-path" data-i18n-placeholder="convert.dir_placeholder" placeholder="Rechercher une s&#233;rie..." class="config-input" autocomplete="off">
                            <div class="convert-path-suggestions" id="convert-path-suggestions"></div>
                        </div>
                        <button id="btn-scan-cbr" type="button" class="btn-config-add" data-i18n="convert.btn.scan">Scanner</button>
                    </div>
                    <div class="convert-options">
                        <label><input type="checkbox" id="convert-delete-original"> <span data-i18n="convert.delete_original">Supprimer les CBR apr&#232;s conversion</span></label>
                    </div>
                </div>

                <div class="convert-progress" id="convert-progress" style="display:none">
                    <div class="audit-loader-bar"></div>
                    <p id="convert-progress-text" data-i18n="convert.progress">Conversion en cours...</p>
                </div>

                <div class="convert-table-wrap">
                    <table class="convert-table">
                        <thead>
                            <tr>
                                <th class="col-check"><input type="checkbox" id="convert-select-all"></th>
                                <th data-i18n="convert.col.file">Fichier</th>
                                <th data-i18n="convert.col.tome">Tome</th>
                                <th data-i18n="convert.col.size">Taille</th>
                                <th data-i18n="convert.col.status">Statut</th>
                            </tr>
                        </thead>
                        <tbody id="convert-tbody">
                            <tr class="empty-row"><td colspan="5" data-i18n="convert.empty">Entrez un chemin et scannez pour trouver les fichiers CBR</td></tr>
                        </tbody>
                    </table>
                </div>

                <div class="convert-actions">
                    <button id="btn-convert" type="button" disabled data-i18n="convert.btn.convert">Convertir la s&#233;lection</button>
                    <button id="btn-cancel-convert" type="button" class="btn-cancel-convert" style="display:none" data-i18n="convert.btn.cancel">Annuler</button>
                </div>
            </div>
        </section>

        <!-- TRIAGE OVERLAY -->
        <div id="triage-overlay" class="triage-overlay" style="display:none">
            <div class="triage-backdrop"></div>
            <div class="triage-content">
                <div class="triage-header">
                    <h2 data-i18n="triage.title">Triage rapide</h2>
                    <span class="triage-counter" id="triage-counter"></span>
                    <button class="triage-close" id="btn-triage-close" type="button" title="Escape">&times;</button>
                </div>
                <div class="triage-card" id="triage-card">
                    <div class="triage-file-info">
                        <div class="triage-filename" id="triage-filename"></div>
                        <div class="triage-file-meta">
                            <span class="triage-file-size" id="triage-file-size"></span>
                            <span class="triage-file-ext" id="triage-file-ext"></span>
                        </div>
                    </div>
                    <div class="triage-detection">
                        <div class="triage-field">
                            <label data-i18n="files.col.series">S&#233;rie d&#233;tect&#233;e</label>
                            <span id="triage-series-guess" class="triage-value"></span>
                            <span id="triage-confidence" class="triage-confidence"></span>
                        </div>
                    </div>
                    <div class="triage-form">
                        <div class="triage-field">
                            <label data-i18n="action.series_name">Nom de la s&#233;rie</label>
                            <div class="triage-search-wrap">
                                <input type="text" id="triage-series" autocomplete="off">
                                <div class="triage-dropdown" id="triage-dropdown"></div>
                            </div>
                        </div>
                        <div class="triage-field-row">
                            <div class="triage-field">
                                <label data-i18n="action.destination">Destination</label>
                                <select id="triage-destination"></select>
                            </div>
                            <div class="triage-field triage-field-sm">
                                <label data-i18n="files.col.tome">Tome</label>
                                <input type="number" id="triage-tome" min="0" class="tome-input">
                            </div>
                            <div class="triage-field">
                                <label data-i18n="files.col.title">Titre</label>
                                <input type="text" id="triage-title" autocomplete="off">
                            </div>
                        </div>
                        <div class="triage-preview" id="triage-preview"></div>
                    </div>
                </div>
                <div class="triage-actions">
                    <button class="triage-btn triage-btn-delete" id="btn-triage-delete" type="button">
                        <span class="triage-key">Suppr</span>
                        <span data-i18n="config.delete">Supprimer</span>
                    </button>
                    <button class="triage-btn triage-btn-skip" id="btn-triage-prev" type="button">
                        <span class="triage-key">&larr;</span>
                        <span data-i18n="triage.prev">Pr&#233;c&#233;dent</span>
                    </button>
                    <button class="triage-btn triage-btn-skip" id="btn-triage-skip" type="button">
                        <span class="triage-key">&rarr;</span>
                        <span data-i18n="triage.skip">Passer</span>
                    </button>
                    <button class="triage-btn triage-btn-organize" id="btn-triage-organize" type="button">
                        <span class="triage-key">Entr&#233;e</span>
                        <span data-i18n="action.organize">Organiser</span>
                    </button>
                </div>
            </div>
        </div>

        <!-- DROP OVERLAY -->
        <div id="drop-overlay" class="drop-overlay" style="display:none">
            <div class="drop-overlay-content">
                <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="17 8 12 3 7 8"/><line x1="12" y1="3" x2="12" y2="15"/></svg>
                <p data-i18n="upload.drop_here">D&#233;poser les fichiers ici</p>
                <span class="drop-overlay-hint" data-i18n="upload.drop_formats">CBR, CBZ, PDF</span>
            </div>
        </div>

        <div class="toast-container" id="toast-container"></div>
    </main>

    <script src="{{ url_for('static', filename='i18n.js') }}?v=15"></script>
    <script src="{{ url_for('static', filename='app.js') }}?v=15"></script>
</body>
</html>
